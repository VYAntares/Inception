server {
	# HTTPS Configuration
	# Écoute sur le port 443 (HTTPS) avec SSL activé
	# C'est le seul port exposé à l'extérieur
	listen 443 ssl;
	
	# Domain Configuration
	# Nom de domaine accepté par ce serveur
	# Doit correspondre à DOMAIN_NAME dans .env
	server_name eahmeti.42.fr;
	
	# SSL/TLS Certificates
	# Ces certificats permettent le chiffrement HTTPS
	# Ils seront générés automatiquement au démarrage par le script
	ssl_certificate     /etc/nginx/ssl/nginx.crt;      # Certificat public
	ssl_certificate_key /etc/nginx/ssl/nginx.key;      # Clé privée
	
	# SSL Protocols
	# Protocoles de chiffrement autorisés
	# TLSv1.2 et TLSv1.3 sont les versions modernes et sécurisées
	# On n'autorise PAS TLSv1.0 et TLSv1.1 (obsolètes et vulnérables)
	ssl_protocols TLSv1.2 TLSv1.3;
	
	# Root Directory
	# Dossier racine des fichiers du site
	# IMPORTANT : Même volume que WordPress (wordpress_data)
	# Permet à NGINX de lire les fichiers statiques créés par WordPress
	root /var/www/html;
	
	# Index Files
	# Fichiers à servir par défaut quand on demande un dossier
	# Ordre de priorité : index.php puis index.html
	index index.php index.html;
	
	# General Location Block
	# Gestion des fichiers
	location / {
		# Essaye de servir le fichier directement
		# Si pas trouvé, envoie à WordPress (index.php)
		# $uri = fichier demandé, $uri/ = dossier, /index.php = WordPress
		try_files $uri $uri/ /index.php?$args;
	}

	# PHP Processing
	# Tous les fichiers .php sont envoyés à PHP-FPM
	location ~ \.php$ {
		# Sécurité : empêche l'exécution de fichiers PHP dangereux
		try_files $uri =404;
		#         │     └─ Si pas trouvé, renvoie 404
		#         └─ Vérifie si le fichier existe

		# Découpe le chemin PHP en 2 parties
		# Exemple : /index.php/article/123
		#   Groupe 1 : /index.php        (fichier à exécuter)
		#   Groupe 2 : /article/123      (paramètres PATH_INFO)
		# Permet à PHP de distinguer le fichier des paramètres
		fastcgi_split_path_info ^(.+\.php)(/.+)$;

		fastcgi_pass wordpress:9000;
#            │         └─ Port où PHP-FPM écoute
#            └─ Nom du conteneur

		# Fichier PHP par défaut
		# Si un dossier est demandé (ex: /wp-admin/), NGINX cherche index.php dedans
		# Équivalent à "index index.php" mais pour FastCGI
		fastcgi_index index.php;
		
		# Charge les paramètres FastCGI standards
		# Fichier fourni par NGINX avec ~20 variables essentielles
		# (REQUEST_METHOD, QUERY_STRING, CONTENT_TYPE, etc.)
		# Évite de réécrire manuellement toutes ces variables
		include fastcgi_params;
		
		# Indique à PHP-FPM le chemin COMPLET du fichier à exécuter
		# $document_root = /var/www/html (défini par "root" plus haut)
		# $fastcgi_script_name = /index.php (le fichier demandé)
		# Résultat : /var/www/html/index.php
		# CRITIQUE : sans ça, PHP-FPM ne sait pas quel fichier exécuter !
		fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
		
		# Transmet PATH_INFO à PHP (paramètres après .php)
		# Exemple : /index.php/article/123 → PATH_INFO = /article/123
		# Utilisé par certaines applications (WordPress rarement)
		fastcgi_param PATH_INFO $fastcgi_path_info;	}
}
